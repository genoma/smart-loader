/*!
 * Copyright © 2013 Alessandro Vioni - @jenoma
 * Graphic © 2013 Marco Temperilli

 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

(function(e){"use strict";e.fn.smartLoader=function(n){var t={howManySeconds:1e3,lengthOfLoop:200,callback:function(){},errorCallback:function(){},theControl:"document"};return n=e.extend({},t,n),this.each(function(){function t(e){var n=e,t=[e.attr("src")];n.attr("src","smart-loader-loaders/white.png"),n.css({background:"url(smart-loader-loaders/SmartLoader30.gif)","background-repeat":"no-repeat","background-position":"center center"}),e=new Image,e.onload=function(){s++,n.attr("src",t[0])},e.src=t[0]}function o(e){var n=[e.attr("src")];e=new Image,e.onload=function(){s++},e.src=n[0]}function a(e){console.log("loop"),console.log(g);var t=(new Date).getTime()-l;s!==g&&t>=n.howManySeconds?(clearInterval(e),n.errorCallback.call(i)):s===g&&(clearInterval(e),n.callback.call(i))}var r,c=e("img"),l=(new Date).getTime(),s=0,i=jQuery(this),u=document.getElementsByTagName("img"),g=u.length;console.log(g),"document"===n.theControl?(c.each(function(){o(e(this))}),r=setInterval(function(){a(r)},n.lengthOfLoop)):"images"===n.theControl&&(c.each(function(){t(e(this))}),r=setInterval(function(){a(r)},n.lengthOfLoop))})}})(jQuery);